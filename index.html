<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Team Task Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">

  <div class="container">
    <h1 class="mb-4 text-center">📋 Daily Task Manager</h1>

    <div class="mb-3 text-center">
      <button class="btn btn-danger" onclick="filterUrgent()">🚨 Urgent Only</button>
      <button class="btn btn-warning" onclick="filterFollowUp()">📌 Follow-Ups</button>
      <button class="btn btn-secondary" onclick="showAll()">🔁 Show All</button>
    </div>

    <div class="table-responsive">
      <table class="table table-bordered table-hover align-middle">
        <thead class="table-dark">
          <tr>
            <th>Date</th>
            <th>Team Member</th>
            <th>Task</th>
            <th>Status</th>
            <th>Priority</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody id="taskTableBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    let allTasks = [];

    async function fetchTasks() {
      try {
        const res = await fetch("https://rupalibhosale.app.n8n.cloud/webhook-test/client-tasks");
        const data = await res.json();

        if (!data.tasks || !Array.isArray(data.tasks)) {
          throw new Error("Unexpected response format");
        }

        allTasks = data.tasks;
        renderTasks(allTasks);
      } catch (error) {
        const tableBody = document.getElementById("taskTableBody");
        tableBody.innerHTML = `<tr><td colspan="6" class="text-danger">❌ Failed to load tasks: ${error.message}</td></tr>`;
      }
    }

    function renderTasks(tasks) {
      const tableBody = document.getElementById("taskTableBody");
      if (!tasks.length) {
        tableBody.innerHTML = `<tr><td colspan="6" class="text-warning text-center">⚠️ No tasks found.</td></tr>`;
        return;
      }

      tableBody.innerHTML = tasks.map(task => `
        <tr>
          <td>${task.date?.split("T")[0] || ''}</td>
          <td>${task.team_member || ''}</td>
          <td>${task.task || ''}</td>
          <td>${task.status || ''}</td>
          <td>${task.priority || ''}</td>
          <td>${task.notes || ''}</td>
        </tr>
      `).join('');
    }

    function filterUrgent() {
      const filtered = allTasks.filter(t => t.priority?.toLowerCase() === 'high');
      renderTasks(filtered);
    }

    function filterFollowUp() {
      const filtered = allTasks.filter(t => t.status?.toLowerCase() === 'pending');
      renderTasks(filtered);
    }

    function showAll() {
      renderTasks(allTasks);
    }

    // Fetch tasks on page load
    fetchTasks();
  </script>

</body>
</html>
