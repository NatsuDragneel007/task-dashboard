<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Task Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body class="p-4">
  <h2 class="mb-4">🧠 Daily Task Dashboard</h2>

  <div class="mb-3">
    <button class="btn btn-danger" onclick="filterTasks('High')">🚨 Urgent Only</button>
    <button class="btn btn-warning" onclick="filterTasks('Pending')">📌 Follow-Ups</button>
    <button class="btn btn-secondary" onclick="showAll()">🔁 Show All</button>
  </div>

  <table class="table table-striped table-bordered">
    <thead class="table-dark">
      <tr>
        <th>Date</th>
        <th>Team Member</th>
        <th>Task</th>
        <th>Status</th>
        <th>Priority</th>
        <th>Notes</th>
      </tr>
    </thead>
    <tbody id="taskList">
      <tr><td colspan="6">Loading tasks...</td></tr>
    </tbody>
  </table>

  <script>
    let allTasks = [];

    async function fetchTasks() {
      try {
        const res = await fetch("https://rupalibhosale.app.n8n.cloud/webhook/client-tasks");
        const data = await res.json();

        if (!data.tasks || !Array.isArray(data.tasks)) {
          document.getElementById("taskList").innerHTML =
            `<tr><td colspan="6">❌ Unexpected response format.</td></tr>`;
          return;
        }

        allTasks = data.tasks;
        renderTasks(allTasks);
      } catch (err) {
        document.getElementById("taskList").innerHTML =
          `<tr><td colspan="6">❌ Failed to load tasks: ${err.message}</td></tr>`;
      }
    }

    function renderTasks(tasks) {
      const tbody = document.getElementById("taskList");
      if (tasks.length === 0) {
        tbody.innerHTML = `<tr><td colspan="6">No matching tasks.</td></tr>`;
        return;
      }

      tbody.innerHTML = "";
      tasks.forEach(task => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${task.date.split("T")[0]}</td>
          <td>${task.team_member}</td>
          <td>${task.task}</td>
          <td>${task.status}</td>
          <td>${task.priority}</td>
          <td>${task.notes}</td>
        `;
        tbody.appendChild(row);
      });
    }

    function filterTasks(criteria) {
      const filtered = allTasks.filter(task =>
        task.priority === criteria || task.status === criteria
      );
      renderTasks(filtered);
    }

    function showAll() {
      renderTasks(allTasks);
    }

    fetchTasks();
  </script>
</body>
</html>
